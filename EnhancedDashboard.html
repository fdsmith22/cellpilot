<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <?!= include('SharedStyles'); ?>
  <style>
    /* Dashboard Specific Styles */
    .dashboard-container {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      position: relative;
      overflow: hidden;
    }
    
    /* Animated Background Pattern */
    .dashboard-container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      animation: float 20s linear infinite;
    }
    
    @keyframes float {
      0% { transform: translate(0, 0); }
      100% { transform: translate(-50%, -50%); }
    }
    
    .dashboard-content {
      position: relative;
      z-index: 1;
      padding: 20px;
    }
    
    /* Enhanced Header */
    .dashboard-header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.8);
      position: relative;
      overflow: hidden;
    }
    
    .dashboard-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
      background-size: 300% 100%;
      animation: gradient 5s ease infinite;
    }
    
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }
    
    .logo-animated {
      animation: logoFloat 3s ease-in-out infinite;
    }
    
    @keyframes logoFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    /* Smart Selection Card */
    .selection-card {
      background: linear-gradient(135deg, #667eea15, #764ba215);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .selection-card.active {
      border-color: rgba(102, 126, 234, 0.5);
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
    }
    
    .selection-indicator {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .selection-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      animation: pulse 2s infinite;
    }
    
    .selection-details {
      flex: 1;
    }
    
    .selection-range {
      font-size: 14px;
      font-weight: 600;
      color: var(--gray-800);
      margin-bottom: 4px;
    }
    
    .selection-meta {
      font-size: 11px;
      color: var(--gray-600);
      display: flex;
      gap: 12px;
    }
    
    .selection-meta-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    /* Quick Actions - Redesigned */
    .quick-actions-section {
      margin-bottom: 24px;
    }
    
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .section-title {
      font-size: 14px;
      font-weight: 700;
      color: white;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .section-badge {
      background: rgba(255, 255, 255, 0.2);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 10px;
      color: white;
    }
    
    .quick-actions-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 12px;
    }
    
    .action-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.8);
      min-height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .action-card::before {
      content: '';
      position: absolute;
      top: -100%;
      left: -100%;
      width: 300%;
      height: 300%;
      background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
      transition: all 0.5s ease;
      opacity: 0;
    }
    
    .action-card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      border-color: var(--primary-400);
    }
    
    .action-card:hover::before {
      opacity: 1;
      animation: ripple 0.6s ease;
    }
    
    @keyframes ripple {
      0% { transform: scale(0); }
      100% { transform: scale(1); }
    }
    
    .action-icon-container {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
      font-size: 24px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .action-card:hover .action-icon-container {
      transform: rotate(10deg) scale(1.1);
    }
    
    /* Different gradients for different actions */
    .action-card:nth-child(1) .action-icon-container {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }
    
    .action-card:nth-child(2) .action-icon-container {
      background: linear-gradient(135deg, #f093fb, #f5576c);
      color: white;
    }
    
    .action-card:nth-child(3) .action-icon-container {
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: white;
    }
    
    .action-card:nth-child(4) .action-icon-container {
      background: linear-gradient(135deg, #43e97b, #38f9d7);
      color: white;
    }
    
    .action-card:nth-child(5) .action-icon-container {
      background: linear-gradient(135deg, #fa709a, #fee140);
      color: white;
    }
    
    .action-card:nth-child(6) .action-icon-container {
      background: linear-gradient(135deg, #30cfd0, #330867);
      color: white;
    }
    
    .action-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--gray-800);
      margin-bottom: 4px;
    }
    
    .action-description {
      font-size: 10px;
      color: var(--gray-600);
      line-height: 1.4;
    }
    
    .action-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 3px 8px;
      border-radius: 20px;
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .badge-ml {
      background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
      color: white;
    }
    
    .badge-new {
      background: linear-gradient(135deg, #43e97b, #38f9d7);
      color: white;
      animation: pulse 2s infinite;
    }
    
    .badge-pro {
      background: linear-gradient(135deg, #ffd700, #ffb700);
      color: var(--gray-800);
    }
    
    /* Feature Sections with Collapsible Cards */
    .feature-section {
      margin-bottom: 20px;
    }
    
    .feature-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.8);
      transition: all 0.3s ease;
    }
    
    .feature-header {
      padding: 16px 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .feature-header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 20px;
      right: 20px;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--gray-200), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .feature-card.expanded .feature-header::after {
      opacity: 1;
    }
    
    .feature-header:hover {
      background: var(--gray-50);
    }
    
    .feature-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .feature-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    .feature-text {
      flex: 1;
    }
    
    .feature-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--gray-800);
      margin-bottom: 2px;
    }
    
    .feature-subtitle {
      font-size: 11px;
      color: var(--gray-600);
    }
    
    .feature-arrow {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--gray-400);
      transition: all 0.3s ease;
    }
    
    .feature-card.expanded .feature-arrow {
      transform: rotate(90deg);
      color: var(--primary-600);
    }
    
    .feature-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    
    .feature-card.expanded .feature-content {
      max-height: 500px;
    }
    
    .feature-items {
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .feature-item {
      padding: 12px 16px;
      background: var(--gray-50);
      border-radius: 10px;
      font-size: 12px;
      color: var(--gray-700);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .feature-item:hover {
      background: var(--primary-50);
      color: var(--primary-700);
      transform: translateX(4px);
    }
    
    /* Search Bar */
    .search-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 255, 255, 0.8);
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.3s ease;
    }
    
    .search-container:focus-within {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }
    
    .search-icon {
      color: var(--gray-400);
      font-size: 18px;
    }
    
    .search-input {
      flex: 1;
      border: none;
      background: none;
      font-size: 13px;
      color: var(--gray-800);
      outline: none;
    }
    
    .search-input::placeholder {
      color: var(--gray-400);
    }
    
    /* Floating Action Button */
    .fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(82, 113, 255, 0.3);
      transition: all 0.3s ease;
      font-size: 24px;
      z-index: 100;
    }
    
    .fab:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 12px 32px rgba(82, 113, 255, 0.4);
    }
    
    .fab:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <div class="dashboard-content">
      <!-- Enhanced Header -->
      <div class="dashboard-header">
        <div class="logo-container">
          <svg class="logo-animated" viewBox="0 0 200 60" width="180" height="54">
            <!-- Modern Logo Design -->
            <defs>
              <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
              </linearGradient>
            </defs>
            
            <!-- Icon -->
            <g transform="translate(10, 10)">
              <rect x="0" y="0" width="40" height="40" rx="10" fill="url(#logoGradient)" opacity="0.1"/>
              <rect x="5" y="5" width="30" height="30" rx="8" fill="none" stroke="url(#logoGradient)" stroke-width="2"/>
              
              <!-- Grid Pattern -->
              <line x1="15" y1="5" x2="15" y2="35" stroke="url(#logoGradient)" stroke-width="1" opacity="0.5"/>
              <line x1="25" y1="5" x2="25" y2="35" stroke="url(#logoGradient)" stroke-width="1" opacity="0.5"/>
              <line x1="5" y1="15" x2="35" y2="15" stroke="url(#logoGradient)" stroke-width="1" opacity="0.5"/>
              <line x1="5" y1="25" x2="35" y2="25" stroke="url(#logoGradient)" stroke-width="1" opacity="0.5"/>
              
              <!-- Center Dot -->
              <circle cx="20" cy="20" r="3" fill="url(#logoGradient)"/>
            </g>
            
            <!-- Text -->
            <text x="60" y="35" font-family="system-ui, -apple-system, sans-serif" font-size="24" font-weight="700" fill="#1f2937">
              Cell<tspan fill="url(#logoGradient)">Pilot</tspan>
            </text>
            <text x="60" y="48" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#6b7280">
              SMART SPREADSHEET ASSISTANT
            </text>
          </svg>
        </div>
        
        <!-- Smart Selection Indicator -->
        <div class="selection-card active" id="selectionCard">
          <div class="selection-indicator">
            <div class="selection-icon">📊</div>
            <div class="selection-details">
              <div class="selection-range" id="selectionRange">Sheet1!A1:E10</div>
              <div class="selection-meta">
                <div class="selection-meta-item">
                  <span>📏</span>
                  <span id="selectionSize">10 × 5</span>
                </div>
                <div class="selection-meta-item">
                  <span>📈</span>
                  <span id="selectionType">Mixed Data</span>
                </div>
                <div class="selection-meta-item">
                  <span>✨</span>
                  <span>Ready</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Search Bar -->
      <div class="search-container">
        <span class="search-icon">🔍</span>
        <input type="text" class="search-input" placeholder="Search features, formulas, or type a question..." id="searchInput">
      </div>
      
      <!-- Quick Actions Section -->
      <div class="quick-actions-section">
        <div class="section-header">
          <div class="section-title">
            <span>⚡</span>
            <span>Quick Actions</span>
            <span class="section-badge">6</span>
          </div>
        </div>
        
        <div class="quick-actions-container">
          <div class="action-card" onclick="google.script.run.showTableize()">
            <span class="action-badge badge-ml">ML</span>
            <div class="action-icon-container">📋</div>
            <div class="action-title">Tableize</div>
            <div class="action-description">Smart table formatting</div>
          </div>
          
          <div class="action-card" onclick="google.script.run.showDataCleaning()">
            <span class="action-badge badge-ml">ML</span>
            <div class="action-icon-container">🧹</div>
            <div class="action-title">Clean Data</div>
            <div class="action-description">Remove duplicates & fix</div>
          </div>
          
          <div class="action-card" onclick="google.script.run.showSmartFormulaAssistant()">
            <span class="action-badge badge-ml">ML</span>
            <div class="action-icon-container">🧮</div>
            <div class="action-title">Smart Formulas</div>
            <div class="action-description">AI-powered formulas</div>
          </div>
          
          <div class="action-card" onclick="google.script.run.showPivotTableAssistant()">
            <span class="action-badge badge-new">NEW</span>
            <div class="action-icon-container">📊</div>
            <div class="action-title">Pivot Tables</div>
            <div class="action-description">Analyze & summarize</div>
          </div>
          
          <div class="action-card" onclick="google.script.run.showDataPipelineManager()">
            <span class="action-badge badge-new">NEW</span>
            <div class="action-icon-container">🔄</div>
            <div class="action-title">Data Pipeline</div>
            <div class="action-description">Import & export</div>
          </div>
          
          <div class="action-card" onclick="google.script.run.showAutomation()">
            <span class="action-badge badge-pro">PRO</span>
            <div class="action-icon-container">⚙️</div>
            <div class="action-title">Automation</div>
            <div class="action-description">Schedule & triggers</div>
          </div>
        </div>
      </div>
      
      <!-- Feature Sections -->
      <div class="feature-section">
        <div class="feature-card" id="templatesCard">
          <div class="feature-header" onclick="toggleFeature('templates')">
            <div class="feature-info">
              <div class="feature-icon" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                🏢
              </div>
              <div class="feature-text">
                <div class="feature-title">Industry Templates</div>
                <div class="feature-subtitle">Pre-built solutions for your business</div>
              </div>
            </div>
            <div class="feature-arrow">→</div>
          </div>
          <div class="feature-content">
            <div class="feature-items">
              <div class="feature-item" onclick="google.script.run.showIndustryTemplates('construction')">
                <span>🏗️ Construction</span>
                <span style="font-size: 10px; color: var(--gray-500);">3 templates</span>
              </div>
              <div class="feature-item" onclick="google.script.run.showIndustryTemplates('healthcare')">
                <span>🏥 Healthcare</span>
                <span style="font-size: 10px; color: var(--gray-500);">3 templates</span>
              </div>
              <div class="feature-item" onclick="google.script.run.showIndustryTemplates('marketing')">
                <span>📱 Marketing</span>
                <span style="font-size: 10px; color: var(--gray-500);">3 templates</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="feature-section">
        <div class="feature-card" id="advancedCard">
          <div class="feature-header" onclick="toggleFeature('advanced')">
            <div class="feature-info">
              <div class="feature-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white;">
                🚀
              </div>
              <div class="feature-text">
                <div class="feature-title">Advanced Tools</div>
                <div class="feature-subtitle">Power features for complex tasks</div>
              </div>
            </div>
            <div class="feature-arrow">→</div>
          </div>
          <div class="feature-content">
            <div class="feature-items">
              <div class="feature-item" onclick="google.script.run.showDataValidationGenerator()">
                <span>✅ Data Validation</span>
                <span class="badge-ml" style="font-size: 9px; padding: 2px 6px;">ML</span>
              </div>
              <div class="feature-item" onclick="google.script.run.showConditionalFormattingWizard()">
                <span>🎨 Conditional Formatting</span>
                <span class="badge-ml" style="font-size: 9px; padding: 2px 6px;">ML</span>
              </div>
              <div class="feature-item" onclick="google.script.run.showMultiTabRelationshipMapper()">
                <span>🔗 Multi-Tab Mapper</span>
                <span class="badge-ml" style="font-size: 9px; padding: 2px 6px;">ML</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Floating Action Button -->
      <div class="fab" onclick="showHelp()" data-tooltip="Help & Support">
        ?
      </div>
    </div>
  </div>
  
  <script>
    // Initialize
    function initialize() {
      updateSelectionInfo();
      setupSearch();
      setupAnimations();
    }
    
    // Update selection information
    function updateSelectionInfo() {
      google.script.run
        .withSuccessHandler(function(context) {
          if (context && context.hasSelection) {
            document.getElementById('selectionRange').textContent = context.range;
            document.getElementById('selectionSize').textContent = context.rowCount + ' × ' + context.colCount;
            document.getElementById('selectionType').textContent = context.dataType || 'Mixed Data';
            document.getElementById('selectionCard').classList.add('active');
          } else {
            document.getElementById('selectionCard').classList.remove('active');
          }
        })
        .getCurrentUserContext();
    }
    
    // Setup search functionality
    function setupSearch() {
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', debounce(function(e) {
        const query = e.target.value.toLowerCase();
        if (query.length > 2) {
          searchFeatures(query);
        }
      }, 300));
    }
    
    // Search features
    function searchFeatures(query) {
      // Implement search logic
      console.log('Searching for:', query);
    }
    
    // Toggle feature sections
    function toggleFeature(feature) {
      const card = document.getElementById(feature + 'Card');
      card.classList.toggle('expanded');
    }
    
    // Setup animations
    function setupAnimations() {
      // Intersection Observer for scroll animations
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.style.opacity = '1';
              entry.target.style.transform = 'translateY(0)';
            }
          });
        },
        { threshold: 0.1 }
      );
      
      document.querySelectorAll('.action-card, .feature-card').forEach((el) => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'all 0.5s ease';
        observer.observe(el);
      });
    }
    
    // Show help
    function showHelp() {
      google.script.run.showHelp();
    }
    
    // Utility: Debounce
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
    
    // Initialize on load
    document.addEventListener('DOMContentLoaded', initialize);
    
    // Refresh selection info periodically
    setInterval(updateSelectionInfo, 3000);
  </script>
</body>
</html>